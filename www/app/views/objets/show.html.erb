<% content_for(:head_title) { truncate(@objet.nom, length: 20) } %>

<main class="fr-container co-objet-show fr-pt-2w">
  <%= render(
    "shared/breadcrumbs",
    links: [
      ["Accueil", root_path],
      [
        "Objets de #{@objet.commune.nom}",
        current_user ? commune_objets_path(current_user.commune) : objets_path(commune_code_insee: @objet.commune.code_insee)
      ]
    ],
    current_page_label: @objet.nom
  ) %>
  <h2><%= @objet.nom %></h2>
  <p>üìç <%= @objet.commune.nom %> (<%= @objet.departement %>) - ‚õ™Ô∏è <%= @objet.edifice_nom %></p>

  <div class="fr-grid-row fr-pb-4w fr-grid-row--gutters">
    <div class="fr-col-md-4">
      <% if @objet.commune == current_user&.commune %>
        <p>
          <%= render "objets/recensement_badge", objet: @objet %>
          <% if @objet.current_recensement&.editable? %>
            <%= link_to "modifier le recensement", edit_objet_recensement_path(@objet, @objet.current_recensement), class: "fr-link fr-fi-edit-line fr-link--icon-right" %>
          <% end %>
        </p>
      <% end %>
      <p>
        <b>Nom courant</b><br />
        <%= @objet.nom_courant %>
      </p>
      <p>
        <b>Emplacement</b><br />
        Se situe dans l'√©difice <b><%= @objet.edifice_nom %></b><br />
        <i><%= @objet.emplacement %></i>
      </p>
      <p>
        <b>Cat√©gorie</b><br />
        <%= @objet.categorie %>
      </p>
      <p>
        <b>√âpoque</b><br />
        <%= @objet.crafted_at || "N/A" %>
      </p>
      <p>
        <b>R√©colement</b><br />
        Dernier r√©colement : <%= @objet.last_recolement_at || "N/A" %>
      </p>
      <p>
        <b>R√©f√©rences</b><br />
        POP (Base Palissy) : <%= @objet.palissy_REF%>
      </p>
      <p>
        <%= link_to(
          "Voir plus de d√©tails sur la Plateforme Ouverte du Patrimoine",
          "https://www.pop.culture.gouv.fr/notice/palissy/#{@objet.palissy_REF}",
          target: "_blank",
          rel: "noopener",
          class: "co-text--blue"
        ) %>
      </p>
      <% if @objet.commune == current_user&.commune && @objet.recensable? %>
        <div>
          <%= link_to "Recenser cet objet", new_objet_recensement_path(@objet), class: "fr-btn" %>
        </div>
      <% end %>
    </div>
    <div class="fr-col-md-8">
      <div data-controller="photo-gallery">
        <p class="co-text--center">
          <b>
            <%= t(".pop_photos_count", count: @objet.image_urls.count) %>
          </b>
          <a href="#" data-action="photo-gallery#show" class="fr-ml-2w">
            <%= t(".open_gallery_count", count: @objet.image_urls.count) %>
          </a>
        </p>
        <div
          data-photo-gallery-target="photos"
          class="co-photos-grid"
          style="--max-height: <%= @objet.image_urls.count > 2 ? 250 : 500 %>px;"
        >
          <% @objet.image_urls.each_with_index do |image_url, index| %>
            <%= link_to image_url, "data-action": "photo-gallery#show", class: (index >= 6 ? "hide" : "") do %>
              <%= image_tag image_url %>
            <% end %>
          <% end %>
        </div>
        <% if @objet.image_urls.count > 6 %>
          <p class="fr-ml-2w fr-mt-2w co-text--center">
            <a href="#" data-action="photo-gallery#show">
              Voir les <%= @objet.image_urls.count - 6 %> autres photos dans la galerie
            </a>
          </p>
        <% end %>
      </div>
    </div>
  </div>
</main>

<script src="/spotlight.bundle.js"></script>
